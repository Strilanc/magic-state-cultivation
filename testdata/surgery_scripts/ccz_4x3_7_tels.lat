# 8T -> 1CCZ with measurements protected by TELS
# View equivalent circuit in quirk:
#
#     https://algassert.com/quirk#circuit=%7B%22cols%22%3A%5B%5B%22H%22%2C%22H%22%2C%22H%22%2C%22H%22%2C%22H%22%2C%22H%22%2C%22H%22%2C%22H%22%5D%2C%5B%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%2C%22Z%5E%C2%BC%22%5D%2C%5B%22~9t5n%22%2C%22~m8nb%22%2C%22~mq27%22%2C%22~u27n%22%2C%22~obj4%22%2C%22~lm20%22%2C%22~9toi%22%2C%22~t716%22%5D%2C%5B%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C1%2C%22zpar%22%2C1%2C%22X%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C%22Measure%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~18sr%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B%22zpar%22%2C%22zpar%22%2C1%2C1%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C1%2C%22X%22%5D%2C%5B1%2C1%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C%22X%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C%22Measure%22%2C%22Measure%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~iqaa%22%2C%22~nsmo%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B1%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C1%2C1%2C1%2C1%2C%22X%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C%22Measure%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~7vsb%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B1%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C%22zpar%22%2C1%2C%22zpar%22%2C1%2C1%2C1%2C1%2C%22X%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C%22Measure%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C%220%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~vrpd%22%2C%22%E2%80%A6%22%5D%2C%5B1%2C%22Z%5E-%C2%BD%22%2C1%2C1%2C1%2C1%2C1%2C1%2C%22zpar%22%2C1%2C%22zpar%22%5D%2C%5B1%2C1%2C%22Z%5E-%C2%BD%22%2C1%2C1%2C1%2C1%2C1%2C1%2C%22zpar%22%2C1%2C1%2C%22zpar%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C%22Z%5E-%C2%BD%22%2C1%2C1%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%5D%2C%5B1%2C1%2C1%2C1%2C1%2C1%2C%22Z%5E-%C2%BD%22%2C1%2C1%2C%22zpar%22%2C%22zpar%22%2C1%2C%22zpar%22%5D%2C%5B1%2C%22H%22%2C%22H%22%2C1%2C1%2C%22H%22%2C%22H%22%5D%2C%5B1%2C%22Measure%22%2C%22Measure%22%2C1%2C1%2C%22Measure%22%2C%22Measure%22%5D%2C%5B%22%E2%80%A6%22%2C%22~h0t2%22%2C%22~8jh6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~isoq%22%2C%22~aegn%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B%22xpar%22%2C1%2C1%2C%22xpar%22%2C%22Z%22%2C1%2C1%2C%22xpar%22%5D%2C%5B1%2C1%2C1%2C1%2C%22H%22%5D%2C%5B1%2C1%2C1%2C1%2C%22Measure%22%5D%2C%5B1%2C%22zpar%22%2C%22zpar%22%2C1%2C%22zpar%22%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C1%2C1%2C1%2C1%2C%220%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22~22hd%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B1%2C%22zpar%22%2C1%2C%22Z%22%2C1%2C%22zpar%22%2C%22zpar%22%5D%2C%5B%22Z%22%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C1%2C%22zpar%22%5D%2C%5B1%2C%22zpar%22%2C%22zpar%22%2C1%2C1%2C%22zpar%22%2C1%2C%22Z%22%5D%2C%5B%22X%22%2C1%2C1%2C%22X%22%2C1%2C1%2C1%2C%22X%22%5D%2C%5B%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%2C%22%E2%80%A6%22%5D%2C%5B1%2C%22%3C%3C3%22%5D%2C%5B1%2C1%2C%22%3C%3C6%22%5D%2C%5B%22Amps3%22%5D%2C%5B%5D%2C%5B%22%E2%80%A2%22%2C%22%E2%80%A2%22%2C%22Z%22%5D%2C%5B%22H%22%2C%22H%22%2C%22H%22%5D%5D%2C%22gates%22%3A%5B%7B%22id%22%3A%22~18sr%22%2C%22name%22%3A%22mz0126%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~iqaa%22%2C%22name%22%3A%22mz0145%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~nsmo%22%2C%22name%22%3A%22mz2367%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~9t5n%22%2C%22name%22%3A%220%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~m8nb%22%2C%22name%22%3A%221%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~mq27%22%2C%22name%22%3A%222%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~u27n%22%2C%22name%22%3A%223%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~obj4%22%2C%22name%22%3A%224%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~lm20%22%2C%22name%22%3A%225%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~9toi%22%2C%22name%22%3A%226%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~t716%22%2C%22name%22%3A%227%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~7vsb%22%2C%22name%22%3A%22mz1234%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~vrpd%22%2C%22name%22%3A%22mz1257%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~h0t2%22%2C%22name%22%3A%22mxy0%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~isoq%22%2C%22name%22%3A%22mxy2%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~8jh6%22%2C%22name%22%3A%22mxy4%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~aegn%22%2C%22name%22%3A%22mxy6%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%2C%7B%22id%22%3A%22~22hd%22%2C%22name%22%3A%22mx1357%22%2C%22matrix%22%3A%22%7B%7B1%2C0%7D%2C%7B0%2C1%7D%7D%22%7D%5D%7D
#
# T states are prepare inplace within the footprint of the factory.
# Then five Z stabilizers are measured (one redundant, for TELS).
# Then Clifford corrections are resolved by picking between X/Y for four single qubit basis measurements.
# Then the X check stabilizer is measured, to determine if the result is kept.
# Then the result is yielded, after some Pauli feedback.


  /   /   /
 T   T   T   .


 .   .   .   .

  /   /   /
 T   T   T   .

=====================================
measures mz0126

  /   /   /   /
 Z   Z   Z   T
/|  /|  /|
 |   |   |
 X-*-X---X   .
         |
  /   /  |/   /
 Z   Z   Z   T
/   /   /

=====================================
measures mz0145
measures mz2367

  /   /   /   /
 Z   Z   Z   Z
/|  /|  /|  /|
 |   |   |   |
 X-*-X   X-*-X
 |   |   |   |
 |/  |/  |/  |/
 Z   Z   Z   Z
/   /   /   /

=====================================
measures mz1234

  /   /   /   /
 Z   Z   Z   Z
/   /|  /|  /|
     |   |   |
 X-*-X---X---X
 |
 |/   /   /   /
 Z   Z   Z   Z
/   /   /   /

=====================================
measures mz1257

        /    /    /
  Z    Z    Z    Z
 /|   /|   /|   /
  |/   |    |
  Z    X----X-*--X
       |         |
   /   |/    /   |/
  Z    Z    Z    Z
 /    /    /    /

discard_shot_if mz0126 ^ mz0145 ^ mz1234 ^ mz1257 ^ mz2367

=====================================
resolve_at 1+0j with mz0126 ^ mz2367
resolve_at 2+0j with mz1257 ^ mz0145
resolve_at 1+2j with mz0126 ^ mz0145 ^ mz2367
resolve_at 2+2j with mz1257 ^ mz0145 ^ mz2367
measures mxy0
measures mxy2
measures mxy4
measures mxy6

              /
 .   ZY  ZY  Z
    /   /   /

              /
 X---X---X---X
/
  /           /
 Z   ZY  ZY  Z
/   /   /   /

=====================================
measures mx1357

              /
 .   .   Z-@-X
         |  /
         |
         |    /
 .   .   Z---X
         |  /
         |
         |    /
 X---X---Z---X
/           /

discard_shot_if mx1357 ^ mxy0 ^ mxy2 ^ mxy4 ^ mxy6

=====================================
feedback Z at 3 if mxy0 ^ mxy2 ^ mxy6
feedback Z at 3+1j if mxy0 ^ mxy4 ^ mxy6
feedback Z at 3+2j if mxy0 ^ mxy2 ^ mxy4
feedback X at 3
feedback X at 3+1j
feedback X at 3+2j
output_should_be CCZ

             /
.   .   .   X
           / /
.   .   .   X
           / /
.   .   .   X
           /
